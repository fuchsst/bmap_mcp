# .clinerules for the bmad-mcp-server project

## Project Overview & Goals
 This project implements the BMAD MCP Server, a Python-based server that exposes
 the BMAD (Breakthrough Method of Agile AI-driven Development) methodology
 as standardized tools for AI systems like Cline.
 The server uses CrewAI for agentic capabilities and FastMCP for MCP protocol handling.
 Project artifacts and state are managed in a .bmad/ directory using Markdown and JSON.

## Key Technologies
 - Python 3.11+
 - CrewAI (for AI agent orchestration)
 - FastMCP (for Model Context Protocol implementation)
 - Pydantic (for data validation and settings management)
 - FastAPI & Uvicorn (for SSE mode)
 - Docker (for containerization)

# Python Environment & Key Libraries
- Python: Version 3.11 or higher (as specified in `pyproject.toml`).
- Core Dependencies:
  - `fastmcp`: For Model Context Protocol implementation.
  - `crewai>=0.121.0`: For AI agent orchestration.
  - `pydantic>=2.11.5`: For data validation and settings management.
  - `fastapi>=0.115.12` & `uvicorn>=0.34.2`: For the server's SSE mode.
  - `pyyaml`: For YAML parsing, likely for configuration or data files.
  - `python-dotenv`: For managing environment variables, especially for local development.
  - `aiofiles>=24.1.0`: For asynchronous file operations.
  - `click>=8.2.1` & `rich>=14.0.0`: For enhancing the command-line interface.
- Development & Testing Dependencies:
  - `pytest` (and plugins like `pytest-asyncio`, `pytest-cov`): For writing and running tests.
  - `black`, `isort`, `flake8`, `mypy`: For code formatting, linting, and static type checking.
  - `pre-commit`: For managing and maintaining pre-commit hooks.
  - `mkdocs` (and plugins): For generating project documentation.
  (Refer to `pyproject.toml` for specific versions and a complete list of dependencies).


## Development Guidelines
1. Adherence to BMAD Principles: All development and tool implementation should align
   with the BMAD methodology outlined in the project's concept documents.
2. Code Style: Follow PEP 8 guidelines. Use Black for formatting and Flake8/Mypy for linting.
   (Ensure these are configured in pyproject.toml or editor settings).
3. Modularity: Keep code modular. Tools, agents, utilities, and protocol handling
   should be in their respective packages/modules as per the defined project structure.
4. Artifact Management: All BMAD artifacts generated by tools (PRDs, stories, etc.)
   are managed by the `StateManager` and stored in the `.bmad/` directory of the
   project *using* the server, not this server's own project. This server's code
   defines *how* those artifacts are managed.
5. Tool Implementation:
   - New tools must inherit from `bmad_mcp_server.tools.base.BMadTool`.
   - Tools must define `get_input_schema()` for MCP compatibility.
   - Tools should use `StateManager` for artifact persistence.
   - Tools requiring complex AI reasoning should leverage CrewAI agents.
   - Register new tools in `bmad_mcp_server.server.BMadMCPServer._register_tools()`.
6. CrewAI Agents:
   - Define agents in `bmad_mcp_server.crewai_integration.agents.py`.
   - Agents should have clear roles, goals, and backstories aligned with BMAD personas.
7. Configuration:
   - Server configuration is managed via `config.json` (optional) and environment variables.
   - LLM API keys and sensitive settings should be managed via `.env` (for local dev)
     and never committed to the repository. Use `.env.example` as a template.
8. Testing:
   - Write unit tests for new functionality, especially for tools and state management.
   - Aim for high test coverage. Use `pytest`.
9. Documentation:
   - Keep README.md updated with setup, configuration, and usage instructions.
   - Document new tools in `docs/tool_catalog.md`.
   - Add docstrings to all public modules, classes, and functions.
10. Commits: Write clear and concise commit messages. Reference issue numbers if applicable.
11. Use Python type annotations
12. Add a short function description as pydoc
13. Read the file before you want to edit it
14. Use Pydantic to define schema/models
15. For use absolute imports for modules of the project (e.g. src.bmad.mcp.server)
16. Rely on CrewAI and LightLLM to interact with the LLM API provider

## Interaction with this project:
 - When asked to add a new BMAD tool:
   1. Understand the tool's purpose within the BMAD framework.
   2. Create a new Python file in the appropriate `src/bmad_mcp_server/tools/` subdirectory.
   3. Implement the tool class, inheriting from `BMadTool`.
   4. Define its input schema and `execute` method (potentially using CrewAI).
   5. Register the tool in `server.py`.
   6. Add unit tests for the new tool.
   7. Update `docs/tool_catalog.md`.
 - When modifying existing code, ensure changes are consistent with the overall architecture
   and BMAD principles.
 - When working on `StateManager`, be mindful of file I/O operations and potential race conditions
   (though initially, operations are synchronous).
 - Refer to the concept documents in the `concept/` directory for design philosophy and detailed plans.
